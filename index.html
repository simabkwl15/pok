<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>POK</title>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body { font-family: Arial; margin: 20px; }
select { padding: 6px; margin-bottom: 15px; }

table {
  border-collapse: collapse;
  width: 100%;
  font-size: 13px;
}

th, td {
  border: 1px solid #ccc;
  padding: 6px;
}

th { background: #f2f2f2; }

.rm { color: blue; font-weight: bold; }
.pnbp { color: orange; font-weight: bold; }
</style>
</head>

<body>

<h2>POK</h2>

<select id="cmbFilter">
  <option value="Semua">Semua</option>
  <option>Umum</option>
  <option>PKN</option>
  <option>PN</option>
  <option>Penilaian</option>
  <option>Lelang</option>
  <option>HI</option>
  <option>KI</option>
</select>

<table id="tblData">
  <thead></thead>
  <tbody></tbody>
</table>

<script>
const CSV_URL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vSi8QhfAg_PpNxxZ8XYaSF3g5ZB2rYJ4IwG8Zq3vHEGWvOLgsc21aO5V-18qOudsfJ-kkAxF_SyRbok/pub?output=csv";

let data = [];

Papa.parse(CSV_URL, {
  download: true,
  skipEmptyLines: true,
  complete: res => {
    data = res.data;
    console.log("ROW COUNT:", data.length); // DEBUG
    render();
  }
});

cmbFilter.onchange = render;

function render() {
  const thead = tblData.tHead || tblData.createTHead();
  const tbody = tblData.tBodies[0] || tblData.createTBody();

  thead.innerHTML = "";
  tbody.innerHTML = "";

  if (data.length <= 1) return;

  // HEADER
  const hr = document.createElement("tr");
  data[0].forEach(h => {
    const th = document.createElement("th");
    th.textContent = h;
    hr.appendChild(th);
  });
  thead.appendChild(hr);

  const seen = new Set();
  const filter = cmbFilter.value;

  for (let i = 1; i < data.length; i++) {
    const r = data[i];
    const kode = r[0]?.trim();
    const sd   = r[1]?.trim();
    const seksi= r[8]?.trim();

    if (!kode) continue;
    if (filter !== "Semua" && seksi !== filter) continue;

    if (filter === "Semua") {
      if (seen.has(kode)) continue;
      seen.add(kode);
    }

    const tr = document.createElement("tr");

    if (kode.length > 27 && sd === "RM") tr.className = "rm";
    if (kode.length > 27 && sd === "PNBP") tr.className = "pnbp";

    r.forEach(c => {
      const td = document.createElement("td");
      td.textContent = c ?? "";
      tr.appendChild(td);
    });

    tbody.appendChild(tr);
  }
}
</script>

</body>
</html>
