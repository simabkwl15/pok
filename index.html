<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Reset Password | SiMAB</title>

<style>
body{
    margin:0;
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    background:#f5f6fa;
    font-family:Segoe UI, Arial;
}

.card{
    background:#fff;
    width:360px;
    padding:25px;
    border-radius:10px;
    box-shadow:0 10px 30px rgba(0,0,0,.2);
}

h2{
    margin:0 0 10px;
    text-align:center;
}

input{
    width:100%;
    padding:10px;
    margin-top:10px;
    border-radius:6px;
    border:1px solid #ccc;
}

button{
    width:100%;
    margin-top:15px;
    padding:12px;
    border:none;
    border-radius:6px;
    background:#005bea;
    color:#fff;
    font-weight:bold;
    cursor:pointer;
}

.error{
    margin-top:10px;
    color:#d40000;
    font-size:12px;
    text-align:center;
}
</style>
</head>

<body>

<div class="card">
    <h2>Ganti Password</h2>
    <p style="font-size:13px;text-align:center">
        Password default harus diganti sebelum melanjutkan
    </p>

    <input type="password" id="pass1" placeholder="Password baru">
    <input type="password" id="pass2" placeholder="Ulangi password">

    <button onclick="resetPassword()">SIMPAN</button>
    <div class="error" id="err"></div>
</div>

<script>
const apiURL = "https://script.google.com/macros/s/AKfycbxIPQKTaOuQG26lvMc4hQggLsd_nBBnls0Km0-HVXbVPNoz-sKESMTXFXszFnHHWTUh/exec";

function resetPassword(){
    const nip = sessionStorage.getItem("nip");
    const p1 = document.getElementById("pass1").value.trim();
    const p2 = document.getElementById("pass2").value.trim();
    const err = document.getElementById("err");

    err.textContent = "";

    if(!nip){
        window.location.href = "login.html";
        return;
    }

    if(!p1 || !p2){
        err.textContent = "Password wajib diisi";
        return;
    }

    if(p1.length < 6){
        err.textContent = "Password minimal 6 karakter";
        return;
    }

    if(p1 !== p2){
        err.textContent = "Password tidak sama";
        return;
    }

    fetch(apiURL, {
        method:"POST",
        body: JSON.stringify({
            action: "resetPassword",
            nip: nip,
            password: p1
        })
    })
    .then(r=>r.json())
    .then(res=>{
        if(res.status==="success"){
            alert("Password berhasil diubah. Silakan login kembali.");
            sessionStorage.clear();
            window.location.href = "login.html";
        }else{
            err.textContent = res.message;
        }
    })
    .catch(()=>{
        err.textContent = "Gagal menyimpan password";
    });
}
</script>

</body>
</html>
