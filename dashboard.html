<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Dashboard 2026</title>

<style>
body {
    font-family: Arial, sans-serif;
}

table {
    border-collapse: collapse;
    width: 100%;
    margin-bottom: 30px;
}

th, td {
    border: 1px solid #ccc;
    padding: 4px 6px;
    font-size: 13px;
}

th {
    background: #f0f0f0;
    text-align: center;
}

/* Dashboard */
.merge-row td {
    font-weight: bold;
    background: #f7f7f7;
}

.header-row td {
    font-weight: bold;
    text-align: center;
}

.no-border td {
    border: none;
}

/* Bulanan */
#tblBulanan {
    font-size: 11px;
}

.bg-tw {
    background: #e8f5e9;
    font-weight: bold;
}
</style>
</head>

<body>

<h3>Dashboard</h3>
<table id="tblDashboard"></table>

<h3>Realisasi Bulanan</h3>
<table id="tblBulanan"></table>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbx2l9Q9cY-IvHiimtY2jz8RMNYKcm-WpE-89NPNHCvfkNBKYQ_i0hpaXtdrHxJspdM1sQ/exec";

/* UTIL */
function formatNumber(n) {
    if (typeof n !== "number") return n ?? "";
    return n.toLocaleString("id-ID");
}

function formatPersen(n) {
    if (typeof n !== "number") return n ?? "";
    return (n * 100).toFixed(2) + "%";
}

/* RENDER TABLE */
function renderTable(tbl, data, isBulanan = false) {
    if (!data || !data.length) return;

    tbl.innerHTML = "";
    const colCount = data[0].length;

    /* HEADER */
    const thead = document.createElement("thead");
    const trh = document.createElement("tr");
    data[0].forEach(h => {
        const th = document.createElement("th");
        th.textContent = h ?? "";
        trh.appendChild(th);
    });
    thead.appendChild(trh);
    tbl.appendChild(thead);

    /* BODY */
    const tbody = document.createElement("tbody");

    data.slice(1).forEach((row, rowIndex) => {
        const tr = document.createElement("tr");

        /* ===== DASHBOARD ONLY ===== */
        if (!isBulanan) {

            if (rowIndex === 3 || rowIndex === 4) {
                tr.classList.add("no-border");
            }

            if (rowIndex === 5) {
                tr.classList.add("merge-row");
                const td = document.createElement("td");
                td.colSpan = colCount;
                td.textContent = row[0] ?? "";
                td.style.textAlign = "center";
                tr.appendChild(td);
                tbody.appendChild(tr);
                return;
            }

            if (rowIndex === 6) {
                tr.classList.add("header-row");
            }
        }

        /* ===== CELL ===== */
        row.forEach((c, idx) => {
            const td = document.createElement("td");

            /* BULANAN RULES */
            if (isBulanan) {

                /* Row ke-4 (index 3) kolom 5â€“21 persen */
                if (rowIndex === 3 && idx >= 4 && idx <= 20) {
                    td.textContent = formatPersen(c);
                } else {
                    td.textContent = typeof c === "number" ? formatNumber(c) : (c ?? "");
                }

                /* Kolom TW background */
                if ([7, 11, 15, 19].includes(idx)) {
                    td.classList.add("bg-tw");
                }

            } else {
                /* DASHBOARD FORMAT */
                td.textContent = typeof c === "number" ? formatNumber(c) : (c ?? "");
            }

            /* Alignment */
            if (idx === 0) td.style.textAlign = "center";
            if (idx >= 2) td.style.textAlign = "right";

            tr.appendChild(td);
        });

        tbody.appendChild(tr);
    });

    tbl.appendChild(tbody);
}

/* LOAD DATA */
fetch(GAS_URL)
.then(r => r.json())
.then(res => {
    renderTable(
        document.getElementById("tblDashboard"),
        res.dashboard_2026,
        false
    );

    renderTable(
        document.getElementById("tblBulanan"),
        res.bulanan_2026,
        true
    );
});
</script>

</body>
</html>
