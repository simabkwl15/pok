<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard SiMAB</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
<style>

    .cards {
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
    gap:20px;
    margin-bottom:30px;
}

.card {
    background:white; padding:20px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.05);
    display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center;
}
.card h3{ font-size:20px; margin-bottom:10px; }
.card p{ font-size:24px; font-weight:600; }

*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family:'Inter',sans-serif;
}
/* di bagian CSS */
/* Scrollable tbody untuk tabel Kegiatan Hari Ini */
.chart-box table tbody {
    display: block;
    max-height: 250px; /* tinggi scroll */
    overflow-y: auto;
    padding-bottom: 10px; /* jarak bawah agar tidak terlalu mepet */
}

/* agar header tabel tetap rapi */
.chart-box table thead,
.chart-box table tbody tr {
    display: table;
    width: 100%;
    table-layout: fixed;
}

/* tambahan jarak bawah chart-box */
.chart-box {
    margin-bottom: 50px; /* jarak bawah chart-box */
}

    
body{
    display:grid;
    grid-template-columns:240px 1fr;
    background:#f8fafc;
    color:#334155;
}

/* SIDEBAR */
.sidebar{
    height:100vh;
    background:#ffffff;
    border-right:1px solid #e5e7eb;
    display:flex;
    flex-direction:column;
    position:sticky;
    top:0;
}

.sidebar-brand{
    padding:20px;
    background:#e0f2fe;
    color:#0369a1;
    font-weight:600;
    font-size:18px;
    display:flex;
    align-items:center;
    gap:10px;
}

.sidebar ul{
    list-style:none;
    padding:20px 10px;
}

.sidebar ul li{
    padding:10px 14px;
    margin-bottom:6px;
    border-radius:10px;
    cursor:pointer;
    display:flex;
    align-items:center;
    gap:12px;
    font-size:14px;
    color:#475569;
    transition:0.2s;
}

.sidebar ul li:hover{
    background:#f1f5f9;
}

.sidebar ul li.active{
    background:#e0f2fe;
    color:#0369a1;
    font-weight:600;
}

.page-header{
    margin-bottom:25px;
}

.page-header h2{
    font-size:22px;
    font-weight:700;
    margin-bottom:4px;
    color:#0f172a;
}

.page-header p{
    font-size:14px;
    color:#64748b;
}

    
/* MAIN */
.main{
    min-height:100vh;
    display:flex;
    flex-direction:column;
}

/* TOPBAR */
.topbar{
    height:60px;
    background:#ffffff;
    border-bottom:1px solid #e5e7eb;
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:0 30px;
    position:sticky;
    top:0;
    z-index:1000;
}

.topbar-left{
    font-weight:600;
}

.topbar-right{
    display:flex;
    align-items:center;
    gap:18px;
    font-size:14px;
}

.topbar-right i{
    font-size:16px;
    cursor:pointer;
    color:#475569;
    transition:0.2s;
}

.topbar-right i:hover{
    color:#0369a1;
}

.user-info{
    display:flex;
    align-items:center;
    gap:8px;
    font-weight:500;
}

/* CONTENT */
.content{
    padding:30px;
    padding-bottom:80px; /* agar tidak tertutup footer */
}

.cards{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
    gap:20px;
    margin-bottom:25px;
}

.card{
    padding:20px;
    border-radius:16px;
    border:1px solid #e5e7eb;
    transition:0.2s;
    background:white;
}

.card:hover{
    transform:translateY(-4px);
}

.cards .card:nth-child(1){background:#e0f2fe;color:#2F4F4F;}
.cards .card:nth-child(2){background:#dcfce7;color:#2F4F4F;}
.cards .card:nth-child(3){background:#ffedd5;color:#2F4F4F;}
.cards .card:nth-child(4){background:#FFFACD;color:#2F4F4F;}
.cards .card:nth-child(5){background:#fee2e2;color:#2F4F4F;}

.card h3{
    font-size:13px;
    margin-bottom:8px;
}

.card span{
    font-size:24px;
    font-weight:700;
}

.dashboard-grid{
    display:grid;
    grid-template-columns:2fr 1fr;
    gap:20px;
}

.chart-box{
    background:white;
    padding:20px;
    border-radius:16px;
    border:1px solid #e5e7eb;
    height:350px;
}

table{
    width:100%;
    border-collapse:collapse;
    font-size:14px;
}

th, td{
    padding:10px;
    border-bottom:1px solid #e5e7eb;
    text-align:left;
}

th{
    background:#f1f5f9;
    font-weight:600;
}

/* FOOTER FREEZE */
.footer{
    position:fixed;
    bottom:0;
    left:240px;
    right:0;
    height:45px;
    background:#ffffff;
    border-top:1px solid #e5e7eb;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:13px;
    color:#64748b;
}

@media(max-width:1000px){
    body{
        grid-template-columns:1fr;
    }
    .footer{
        left:0;
    }
    .dashboard-grid{
        grid-template-columns:1fr;
    }
}
</style>
</head>

<body>

<div class="sidebar">
    <div class="sidebar-brand">
        <i class="fa-solid fa-layer-group"></i>
        <span>SiMAB</span>
    </div>
    <ul>
        <li class="active" onclick="goDashboard()">
            <i class="fa-solid fa-gauge"></i>Dashboard
        </li>
        <li onclick="goPOK()">
            <i class="fa-solid fa-folder-open"></i>POK
        </li>
        <li><i class="fa-solid fa-list-check"></i>Daftar Kegiatan</li>
        <li><i class="fa-solid fa-wallet"></i>Rencana Penarikan Dana</li>
        <li><i class="fa-solid fa-chart-column"></i>Statistik</li>
        <li><i class="fa-solid fa-circle-info"></i>Tentang</li>
</ul>

</div>

<div class="main">

    <div class="topbar">
        <div class="topbar-left">
            Sistem Monitoring Anggaran Belanja
        </div>

        <div class="topbar-right">
            <i class="fa-regular fa-calendar"></i>
            <i class="fa-solid fa-gear"></i>

            <div class="user-info">
                <i class="fa-regular fa-user"></i>
                <span id="namaUser"></span>
            </div>

            <i class="fa-solid fa-right-from-bracket" title="Logout" onclick="logout()"></i>
        </div>
    </div>

    <div class="content">
        <div class="cards">
            <div class="card" id="cardTotal"><h3>Total Kegiatan</h3><p>0</p></div>
            <div class="card" id="cardSelesai"><h3>Selesai</h3><p>0</p></div>
            <div class="card" id="cardTerbayar"><h3>Terbayar</h3><p>0</p></div>
            <div class="card" id="cardLPT"><h3>LPT</h3><p>0</p></div>
            <div class="card" id="cardProses"><h3>Dalam Proses</h3><p>0</p></div>
        </div>


        <div class="dashboard-grid">

            <!-- DIGANTI MENJADI TABEL -->
            <div class="chart-box">
                <h3 style="margin-bottom:15px;">Kegiatan Hari Ini</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Uraian / No ST</th>
                            <th>Pelaksana Tugas</th>
                            <th>Tujuan</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        
                    </tbody>
                </table>
            </div>

            <!-- PIE CHART TETAP -->
            <div class="chart-box">
                <h3>Jenis Kegiatan</h3>
                <canvas id="pieChart"></canvas>
            </div>

        </div>
    </div>
</div>

<!-- FOOTER -->
<div class="footer">
    Â© KPKNL Denpasar 2026
</div>

<script>
document.addEventListener("DOMContentLoaded", function(){

    const nama = sessionStorage.getItem("nama");

    if(!nama){
        window.location.replace("index.html");
    } else {
        document.getElementById("namaUser").textContent = nama;
    }

    // Pie chart tetap sama
    new Chart(document.getElementById('pieChart'),{
        type:'doughnut',
        data:{
            labels:['Barang','Jasa','Perjalanan Dinas','Lainnya'],
            datasets:[{
                data:[35,25,20,20],
                backgroundColor:['#bae6fd','#bbf7d0','#fed7aa','#fecaca']
            }]
        },
        options:{
            responsive:true,
            maintainAspectRatio:false,
            plugins:{legend:{position:'bottom'}},
            cutout:'65%'
        }
    });

});

function goDashboard(){ window.location.href="dashboard.html"; }
function goPOK(){ window.location.href="data_pok.html"; }

function logout(){
    sessionStorage.clear();
    window.location.replace("index.html");
}

// URL GAS (pastikan deploy web app publik)
const urlGAS="https://script.google.com/macros/s/AKfycbwJ-8zAusus3B7hgrvlq4pPr8mLpefVn4AkhZzbD1yFTz0E0Gx8CMTteOOD4W3s5TGPSw/exec";

async function loadDashboard(){
    try{
        const kantor = sessionStorage.getItem("kantor"); // ambil kantor
        if(!kantor) {
            alert("Kantor tidak ditemukan. Silakan login ulang.");
            window.location.replace("index.html");
            return;
        }

        // kirim parameter kantor ke GAS
        const res = await fetch(`${urlGAS}?kantor=${kantor}`);
        const data = await res.json();

        if(data.status !== "success"){
            alert("Gagal memuat data: " + (data.message || "Unknown error"));
            return;
        }

        // Update card dashboard
        document.querySelector("#cardTotal p").textContent = data.dashboard.total;
        document.querySelector("#cardSelesai p").textContent = data.dashboard.selesai;
        document.querySelector("#cardTerbayar p").textContent = data.dashboard.terbayar;
        document.querySelector("#cardLPT p").textContent = data.dashboard.lpt;
        document.querySelector("#cardProses p").textContent = data.dashboard.proses;

        // Update tabel hari ini
        const tbody = document.querySelector(".chart-box tbody");
        tbody.innerHTML = "";
        data.todayRows.forEach(row=>{
            const tr = document.createElement("tr");
            tr.innerHTML = `<td>${row.uraian}</td><td>${row.pelaksana}</td><td>${row.tujuan}</td>`;
            tbody.appendChild(tr);
        });

    }catch(err){
        console.error(err);
        alert("Gagal memuat data dashboard!");
    }
}




loadDashboard();

setInterval(loadDashboard, 30000);
   

</script>


    
</body>
</html>
