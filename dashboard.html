<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
body { 
  font-family:'Inter', Arial, sans-serif; 
  margin:20px; 
  background:#f5f6fa; 
  color:#333; 
}

h2 { margin-bottom:10px; }

/* ===== FILTER BAR ===== */
.filter-bar { 
  margin-bottom:10px; 
  display:flex; 
  align-items:center; 
  gap:10px; 
  flex-wrap:wrap; 
}
.filter-bar label { font-size:14px; }
.filter-bar select, 
.filter-bar input { 
  padding:6px; 
  font-size:13px; 
}
.filter-bar input { 
  flex:1; 
  min-width:150px; 
}

.btn-back { 
  padding:6px 12px; 
  background:green; 
  color:white; 
  border:none; 
  border-radius:4px; 
  cursor:pointer; 
  font-size:14px; 
}
.btn-back:hover { opacity:0.85; }

/* ===== TABLE ===== */
.table-container { 
  max-height: calc(100vh - 160px); 
  overflow:auto; 
  background:white; 
  border-radius:6px; 
  box-shadow:0 2px 8px rgba(0,0,0,0.1);
}

table { 
  border-collapse:collapse; 
  width:100%; 
  min-width:700px; 
  font-size:13px; 
  table-layout:fixed; 
}

th, td { 
  border:1px solid #ddd; 
  padding:8px; 
  word-wrap:break-word; 
}

th { 
  background:#8e44ad; 
  color:white; 
  position:sticky; 
  top:0; 
  z-index:1; 
  text-align:left; 
  white-space:normal; 
  font-size:12px; 
}
</style>
</head>
<body>

<h2>Dashboard</h2>

<div class="filter-bar">
    <label>Filter:</label>
    <select id="cmbFilter">
        <option value="Semua">Semua</option>
    </select>

    <label>Cari:</label>
    <input type="text" id="txtCari" placeholder="Cari data...">

    <button class="btn-back" onclick="window.location.href='?page=data_pok'">Kembali</button>
</div>

<div class="table-container">
    <table id="tblData">
        <thead></thead>
        <tbody></tbody>
    </table>
</div>

<script>
const URL_GAS = "https://script.google.com/macros/s/AKfycbxTzkX4vJ8109ocyx8pgYB0fSl72PtNe-6eHYeSXbWkigiOjXiKpixOzrBtQ3SvoGEK8A/exec";
const tblData = document.getElementById("tblData");
const txtCari = document.getElementById("txtCari");
let data = [];

/* ===== RENDER TABLE ===== */
function renderTable(){
    if(!data || data.length < 2) return;

    const thead = tblData.tHead || tblData.createTHead();
    const tbody = tblData.tBodies[0] || tblData.createTBody();
    thead.innerHTML = "";
    tbody.innerHTML = "";

    // Header
    const header = data[0];
    const trh = document.createElement("tr");
    header.forEach(h=>{
        const th = document.createElement("th");
        th.textContent = h ?? "";
        trh.appendChild(th);
    });
    thead.appendChild(trh);

    const keyword = txtCari.value.toLowerCase();
    let rows = data.slice(1);

    if(keyword){
        rows = rows.filter(r => r.join(" ").toLowerCase().includes(keyword));
    }

    rows.forEach(r=>{
        const tr = document.createElement("tr");
        r.forEach(c=>{
            const td = document.createElement("td");
            td.textContent = c ?? "";
            tr.appendChild(td);
        });
        tbody.appendChild(tr);
    });
}

/* ===== LOAD DATA ===== */
function loadData(){
    fetch(URL_GAS + "?page=dashboard&t=" + Date.now())
        .then(r => r.json())
        .then(j => {
            data = j;
            renderTable();
        })
        .catch(err => console.error(err));
}

txtCari.addEventListener("input", renderTable);

window.addEventListener("DOMContentLoaded", ()=>{
    loadData();
    setInterval(loadData, 60000); // auto refresh 1 menit
});
</script>

</body>
</html>
