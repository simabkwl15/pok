<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
body { 
    font-family: 'Inter', Arial, sans-serif; 
    margin:20px; 
    background:#f5f6fa; 
    color:#333; 
}

.header {
    display:flex;
    justify-content:space-between;
    align-items:flex-end;
    margin-bottom:10px;
}

h2 { margin:0; }

.btn-back { 
    padding:6px 14px; 
    background:green; 
    color:white; 
    border:none; 
    border-radius:4px; 
    cursor:pointer; 
    font-size:14px; 
}
.btn-back:hover { opacity:0.85; }

.table-container { 
    max-height: calc(100vh - 140px); 
    overflow:auto; 
    background:white; 
    border-radius:6px; 
    box-shadow:0 2px 8px rgba(0,0,0,0.1);
}

table { 
    border-collapse:collapse; 
    width:100%; 
    min-width:700px; 
    font-size:13px; 
    table-layout:fixed; 
}

th, td { 
    border:1px solid #ddd; 
    padding:8px; 
    word-wrap:break-word; 
}

th { 
    background:#8e44ad; 
    color:white; 
    position:sticky; 
    top:0; 
    z-index:1; 
    text-align:left; 
    font-size:12px; 
}
</style>
</head>
<body>

<div class="header">
    <h2>Dashboard</h2>
    <button class="btn-back" onclick="window.location.href='data_pok.html'">Kembali</button>
</div>

<div class="table-container">
    <table id="tblDashboard">
        <thead></thead>
        <tbody></tbody>
    </table>
</div>

<script>
const URL_GAS = "https://script.google.com/macros/s/AKfycbwHQsisJDPROZBUKm3DpURW0wf2mBWB_G6_8YIrUW4eedD37RvYpbEcVaVSN6Y85jXaTA/exec";
const tbl = document.getElementById("tblDashboard");
let data = [];

function formatRibuan(num){
    if(num === "" || num == null) return "";
    if(isNaN(num)) return num;
    return Number(num).toLocaleString("id-ID");
}

function formatPersen(num){
    if(num === "" || num == null) return "";
    if(isNaN(num)) return num;
    return (Number(num) * 100).toFixed(2) + "%";
}

function renderTable(){
    if(!data || data.length === 0) return;

    const thead = tbl.tHead || tbl.createTHead();
    const tbody = tbl.tBodies[0] || tbl.createTBody();
    thead.innerHTML = "";
    tbody.innerHTML = "";

    // HEADER
    const trh = document.createElement("tr");
    data[0].forEach(h=>{
        const th = document.createElement("th");
        th.textContent = h ?? "";
        trh.appendChild(th);
    });
    thead.appendChild(trh);

    // DATA
    data.slice(1).forEach(row=>{
        const tr = document.createElement("tr");

        row.forEach((c, idx)=>{
            const td = document.createElement("td");

            // Kolom 1 (index 0) → tengah
            if(idx === 0){
                td.style.textAlign = "center";
                td.textContent = c ?? "";
            }
            // Kolom 9 & 10 (index 8 & 9) → persen
            else if(idx === 8 || idx === 9){
                td.style.textAlign = "right";
                td.textContent = formatPersen(c);
            }
            // Kolom 3 s.d 10 (index 2–9) → kanan
            else if(idx >= 2 && idx <= 9){
                td.style.textAlign = "right";
                td.textContent = formatRibuan(c);
            }
            // Lainnya
            else{
                td.textContent = c ?? "";
            }

            tr.appendChild(td);
        });

        tbody.appendChild(tr);
    });
}

function loadData(){
    fetch(URL_GAS + "?sheet=dashboard_2026&t=" + Date.now())
        .then(res => res.json())
        .then(json => {
            data = json;
            renderTable();
        })
        .catch(err => console.error(err));
}

window.addEventListener("DOMContentLoaded", ()=>{
    loadData();
    setInterval(loadData, 60000);
});
</script>

</body>
</html>
