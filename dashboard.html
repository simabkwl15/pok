<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
body{
    font-family:'Inter',Arial,sans-serif;
    margin:20px;
    background:#f5f6fa;
    color:#333;
}
h2{margin:0}
.btn-back{
    padding:6px 14px;
    background:green;
    color:#fff;
    border:none;
    border-radius:4px;
    cursor:pointer;
    font-size:14px;
}
.btn-back:hover{opacity:.85}

.subtitle-bar{
    position:relative;
    margin-top:6px;
    margin-bottom:14px;
}
.subtitle-text{
    font-size:14px;
    color:#555;
    text-align:center;
    font-weight:bold;
}
.subtitle-bar .btn-back{
    position:absolute;
    right:0;
    top:0;
}

.table-container{
    max-height:calc(100vh - 180px);
    overflow:auto;
    background:#fff;
    border-radius:6px;
    box-shadow:0 2px 8px rgba(0,0,0,.1);
    margin-top:10px;
}

table{
    border-collapse:collapse;
    width:100%;
    min-width:700px;
    font-size:13px;
    table-layout:fixed;
}
th,td{
    border:1px solid #ddd;
    padding:8px;
    word-wrap:break-word;
}
th{
    background:#8e44ad;
    color:#fff;
    position:sticky;
    top:0;
    z-index:1;
    text-align:center;
    font-size:12px;
}

.no-border td{
    border:none!important;
    background:#f5f6fa;
    color:#f5f6fa;
}
.header-row td{
    background:#8e44ad;
    color:#fff;
    font-weight:bold;
    text-align:center!important;
}
.merge-row td{
    background:#f5f6fa;
    border:none;
    font-weight:600;
    text-align:center;
}
</style>
</head>

<body>

<h2>Dashboard</h2>

<div class="subtitle-bar">
    <div class="subtitle-text">Monitoring Realisasi Anggaran</div>
    <button class="btn-back" onclick="location.href='data_pok.html'">Kembali</button>
</div>

<div class="table-container">
    <table id="tblDashboard"></table>
</div>

<h2 style="margin-top:30px">Rekap Bulanan</h2>

<div class="table-container">
    <table id="tblBulanan"></table>
</div>

<script>
const URL_GAS = "https://script.google.com/macros/s/AKfycbwnDsn8sLqMWkTV3L_skoenbT-74JvXtt9zVYcx9lVFjjxly_Uv9nYqb_Kis8UeDElFHg/exec";

const tblDashboard = document.getElementById("tblDashboard");
const tblBulanan   = document.getElementById("tblBulanan");

function ribuan(v){
    if(v===null||v===""||isNaN(v)) return v ?? "";
    return Number(v).toLocaleString("id-ID");
}
function persen(v){
    if(v===null||v===""||isNaN(v)) return "";
    return (Number(v)*100).toFixed(2)+"%";
}

/* ================= DASHBOARD ================= */
function renderDashboard(data){
    if(!data?.length) return;

    tblDashboard.innerHTML="<thead></thead><tbody></tbody>";
    const thead=tblDashboard.querySelector("thead");
    const tbody=tblDashboard.querySelector("tbody");

    // header
    const trh=document.createElement("tr");
    data[0].forEach(h=>{
        const th=document.createElement("th");
        th.textContent=h??"";
        trh.appendChild(th);
    });
    thead.appendChild(trh);

    const colCount=data[0].length;

    data.slice(1).forEach((row,i)=>{
        const tr=document.createElement("tr");

        if(i===3||i===4) tr.classList.add("no-border");

        if(i===5){
            tr.classList.add("merge-row");
            const td=document.createElement("td");
            td.colSpan=colCount;
            td.textContent=row[0]??"";
            tr.appendChild(td);
            tbody.appendChild(tr);
            return;
        }

        if(i===6) tr.classList.add("header-row");

        row.forEach((c,idx)=>{
            const td=document.createElement("td");

            if(typeof c==="number"){
                td.style.textAlign="right";
                td.textContent=(idx>=9)?persen(c):ribuan(c);
            }else{
                td.textContent=c??"";
                if(idx===0) td.style.textAlign="center";
            }
            tr.appendChild(td);
        });
        tbody.appendChild(tr);
    });
}

/* ================= BULANAN ================= */
function renderBulanan(data){
    if(!data?.length) return;

    tblBulanan.innerHTML="<thead></thead><tbody></tbody>";
    const thead=tblBulanan.querySelector("thead");
    const tbody=tblBulanan.querySelector("tbody");

    const trh=document.createElement("tr");
    data[0].forEach(h=>{
        const th=document.createElement("th");
        th.textContent=h??"";
        trh.appendChild(th);
    });
    thead.appendChild(trh);

    data.slice(1).forEach(row=>{
        const tr=document.createElement("tr");
        row.forEach(c=>{
            const td=document.createElement("td");
            if(typeof c==="number"){
                td.style.textAlign="right";
                td.textContent=ribuan(c);
            }else{
                td.textContent=c??"";
            }
            tr.appendChild(td);
        });
        tbody.appendChild(tr);
    });
}

/* ================= LOAD ================= */
function loadData(){
    fetch(URL_GAS+"?t="+Date.now())
    .then(r=>r.json())
    .then(j=>{
        console.log("GAS:",j);
        renderDashboard(j.dashboard_2026||[]);
        renderBulanan(j.bulanan_2026||[]);
    })
    .catch(e=>console.error(e));
}

document.addEventListener("DOMContentLoaded",()=>{
    loadData();
    setInterval(loadData,60000);
});
</script>

</body>
</html>
