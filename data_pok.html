<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>POK - SiMAB</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js"></script>

<style>
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family:'Inter',sans-serif;
}

body{
    display:grid;
    grid-template-columns:240px 1fr;
    background:#f8fafc;
    color:#334155;
}

/* SIDEBAR */
.sidebar{
    height:100vh;
    background:#ffffff;
    border-right:1px solid #e5e7eb;
    display:flex;
    flex-direction:column;
    position:sticky;
    top:0;
}

.sidebar-brand{
    padding:20px;
    background:#e0f2fe;
    color:#0369a1;
    font-weight:600;
    font-size:18px;
    display:flex;
    align-items:center;
    gap:10px;
}

.sidebar ul{
    list-style:none;
    padding:20px 10px;
}

.sidebar ul li{
    padding:10px 14px;
    margin-bottom:6px;
    border-radius:10px;
    cursor:pointer;
    display:flex;
    align-items:center;
    gap:12px;
    font-size:14px;
    color:#475569;
    transition:0.2s;
}

.sidebar ul li:hover{
    background:#f1f5f9;
}

.sidebar ul li.active{
    background:#e0f2fe;
    color:#0369a1;
    font-weight:600;
}

.page-header{
    margin-bottom:25px;
}

.page-header h2{
    font-size:22px;
    font-weight:700;
    margin-bottom:4px;
    color:#0f172a;
}

.page-header p{
    font-size:14px;
    color:#64748b;
}

/* MAIN */
.main{
    min-height:100vh;
    display:flex;
    flex-direction:column;
}

.topbar{
    height:60px;
    background:#ffffff;
    border-bottom:1px solid #e5e7eb;
    display:flex;
    align-items:center;
    padding:0 30px;
}

.content{
    padding:30px;
    padding-bottom:80px;
}

/* FILTER + SEARCH */
.filter-container{
    background:white;
    padding:20px;
    border-radius:16px;
    border:1px solid #e5e7eb;
    margin-bottom:20px;
    display:flex;
    align-items:center;
    gap:15px;
}

select, input{
    padding:8px 12px;
    border-radius:8px;
    border:1px solid #cbd5e1;
    font-size:14px;
}

/* TABLE */
.table-container{
    max-height:500px;
    overflow:auto;
    background:white;
    border-radius:16px;
    border:1px solid #e5e7eb;
}

table{
    width:100%;
    border-collapse:collapse;
    font-size:14px;
}

thead th{
    position:sticky;
    top:0;
    background:#f1f5f9;
    z-index:10;
}

th, td{
    padding:10px;
    border-bottom:1px solid #e5e7eb;
}

.text-right{ text-align:right; }
.text-center{ text-align:center; }

.btn{
    padding:5px 10px;
    border:none;
    border-radius:6px;
    font-size:12px;
    cursor:pointer;
}

.btn-rekam{
    background:#38bdf8;
    color:white;
}

.btn-detil{
    background:#6366f1;
    color:white;
}

.highlight-rm{ background:#dcfce7; }
.highlight-pnbp{ background:#fef9c3; }

/* FOOTER */
.footer{
    position:fixed;
    bottom:0;
    left:240px;
    right:0;
    height:45px;
    background:#ffffff;
    border-top:1px solid #e5e7eb;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:13px;
    color:#64748b;
}
</style>
</head>

<body>

<div class="sidebar">
    <div class="sidebar-brand">
        <i class="fa-solid fa-layer-group"></i>
        <span>SiMAB</span>
    </div>
    <ul>
        <li onclick="goDashboard()"><i class="fa-solid fa-gauge"></i>Dashboard</li>
        <li class="active" onclick="goPOK()"><i class="fa-solid fa-folder-open"></i>POK</li>
    </ul>
</div>

<div class="main">

<div class="topbar">
    <strong>Sistem Monitoring Anggaran Belanja</strong>
</div>

<div class="content">

<h2 style="margin-bottom:20px;">POK</h2>

<div class="filter-container">
    <strong>Filter</strong>
    <select id="filterSD" onchange="applyFilter()">
        <option value="Semua">Semua</option>
        <option value="Umum">Umum</option>
        <option value="PKN">PKN</option>
        <option value="PN">PN</option>
        <option value="Lelang">Lelang</option>
        <option value="Penilaian">Penilaian</option>
        <option value="HI">HI</option>
        <option value="KI">KI</option>
    </select>

    <input type="text" id="searchBox" placeholder="Cari kode / uraian..." onkeyup="applyFilter()">
</div>

<div class="table-container">
<table id="tabelPOK">
    <thead>
        <tr>
            <th>Kode</th>
            <th>Uraian</th>
            <th>Pagu</th>
            <th>Blokir</th>
            <th>Realisasi</th>
            <th>Sisa</th>
            <th>SD</th>
            <th>Aksi</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>
</div>

</div>
</div>

<div class="footer">
Â© KPKNL Denpasar 2026
</div>

<script>

const urlGAS = "https://script.google.com/macros/s/AKfycbxkeZjWQumvORWktLRLLvkEGq9NUBrHlxKhQxStPadlfnoO6rQusVMw5QxRZ9qmpV4Flw/exec";

let allData = [];

function formatNumber(num){
    return Number(num || 0).toLocaleString("id-ID");
}

function loadData(){
    fetch(urlGAS)
    .then(res => res.json())
    .then(data => {

        const unique = new Map();

        data.forEach(r=>{
            const kode = r[0];
            if(!unique.has(kode)){
                unique.set(kode,r);
            }
        });

        allData = Array.from(unique.values());
        renderTable(allData);
    });
}

function renderTable(data){

    const tbody = document.querySelector("#tabelPOK tbody");
    tbody.innerHTML = "";

    data.forEach(row => {

        const tr = document.createElement("tr");

        const kode = row[0] || "";
        const uraian = row[1] || "";
        const pagu = row[2] || 0;
        const blokir = row[3] || 0;
        const realisasi = row[4] || 0;
        const sisa = row[5] || 0;
        const sd = row[6] || "";

        if(kode.length > 27){
            if(sd === "PNBP") tr.classList.add("highlight-pnbp");
            if(sd === "RM") tr.classList.add("highlight-rm");
        }

        tr.innerHTML = `
            <td>${kode}</td>
            <td>${uraian}</td>
            <td class="text-right">${formatNumber(pagu)}</td>
            <td class="text-right">${formatNumber(blokir)}</td>
            <td class="text-right">${formatNumber(realisasi)}</td>
            <td class="text-right">${formatNumber(sisa)}</td>
            <td class="text-center">${sd}</td>
            <td class="text-center">
                ${kode.length > 27 ? `
                    <button class="btn btn-rekam">Rekam</button>
                    <button class="btn btn-detil">Detil</button>
                ` : ``}
            </td>
        `;

        tbody.appendChild(tr);
    });
}

function applyFilter(){

    const filter = document.getElementById("filterSD").value.toLowerCase();
    const search = document.getElementById("searchBox").value.toLowerCase();

    let filtered = allData.filter(row => {

        const kode = (row[0]||"").toLowerCase();
        const uraian = (row[1]||"").toLowerCase();
        const kolomI = (row[7]||"").toLowerCase(); // filter berdasarkan kolom I

        const matchFilter = filter === "semua" || kolomI.includes(filter);
        const matchSearch = kode.includes(search) || uraian.includes(search);

        return matchFilter && matchSearch;
    });

    renderTable(filtered);
}

function goDashboard(){ window.location.href="dashboard.html"; }
function goPOK(){ window.location.href="data_pok.html"; }

loadData();

</script>

</body>
</html>


